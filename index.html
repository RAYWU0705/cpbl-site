<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <base href="/cpbl-site/">
  <meta charset="UTF-8">
  <title>CPBL è³½ç¨‹èˆ‡æ•¸æ“šç«™</title>
  <link rel="stylesheet" href="css/style.css">
</head>

<body>
  <nav class="nav">
  <div class="nav-inner">
    <a class="brand" href="index.html">CPBL</a>
    <a class="nav-link active" href="index.html">é¦–é </a>
    <a class="nav-link" href="schedule.html">è³½ç¨‹</a>
    <a class="nav-link" href="standings.html">æˆ°ç¸¾</a>
    <a class="nav-link" href="teams.html">çƒéšŠ</a>
  </div>
</nav>


<header>
    <h1>ä¸­è¯è·æ£’è³½ç¨‹èˆ‡æ•¸æ“šç«™</h1>
    <p>ä»Šæ—¥è³½ç¨‹</p>
</header>
<section class="home-features">
  <div class="feature-card">
    <h3>ğŸ“… è³½ç¨‹</h3>
    <p>æŸ¥çœ‹æ¯æ—¥èˆ‡æ•´æœˆä¸­è·è³½ç¨‹ï¼Œæ”¯æ´çƒéšŠèˆ‡æ—¥æœŸç¯©é¸ã€‚</p>
    <a href="schedule.html">å‰å¾€è³½ç¨‹ â†’</a>
  </div>

  <div class="feature-card">
    <h3>ğŸ“Š æˆ°ç¸¾</h3>
    <p>å³æ™‚æŸ¥çœ‹å„éšŠå‹æ•—ã€å‹ç‡èˆ‡æ’åèµ°å‹¢ã€‚</p>
    <a href="standings.html">æŸ¥çœ‹æˆ°ç¸¾ â†’</a>
  </div>

  <div class="feature-card">
    <h3>ğŸŸï¸ çƒéšŠ</h3>
    <p>èªè­˜ä¸­è¯è·æ£’å…­æ”¯çƒéšŠçš„åŸºæœ¬è³‡æ–™èˆ‡ç‰¹è‰²ã€‚</p>
    <a href="teams.html">ç€è¦½çƒéšŠ â†’</a>
  </div>
</section>

<main>
  <section class="quick-links">
    <section class="home-panels" style="margin-top:16px;">
  <div class="panel">
    <h2>ğŸ† æˆ°ç¸¾ TOP 3</h2>
    <div id="top3"></div>
  </div>

  <div class="panel">
    <h2>ğŸ“Œ ç«™å…§ç‹€æ…‹</h2>
    <p style="color:#555; line-height:1.7;">
      ç›®å‰ï¼šè³½ç¨‹å·²æ”¯æ´æœˆä»½/çƒéšŠ/æ—¥æœŸç¯©é¸ï¼›æˆ°ç¸¾å¯æœå°‹ï¼›çƒéšŠé è£½ä½œä¸­ã€‚<br>
      ç›®æ¨™ï¼šè£œä¸Šçƒå ´/æ™‚é–“ã€åŠ ä¸Šæ¯”åˆ†â†’è‡ªå‹•ç®—æˆ°ç¸¾ã€‚
    </p>
  </div>
</section>

  <a class="quick-btn" id="goMonth" href="#">ğŸ“… å‰å¾€æœ¬æœˆè³½ç¨‹</a>

  <a class="quick-btn" href="standings.html">ğŸ“Š å‰å¾€æˆ°ç¸¾</a>
  <a class="quick-btn" href="teams.html">ğŸŸï¸ å‰å¾€çƒéšŠ</a>
</section>

  <section class="home-panels">

    <div class="panel">
      <h2>ä»Šæ—¥è³½ç¨‹</h2>
      <div id="today"></div>
    </div>

    <div class="panel">
      <h2>æœ¬é€±è³½ç¨‹</h2>
      <div id="week"></div>
    </div>

  </section>
</main>

<script>
  function ymd(d) {
    const y = d.getFullYear();
    const m = String(d.getMonth() + 1).padStart(2, "0");
    const day = String(d.getDate()).padStart(2, "0");
    return `${y}-${m}-${day}`;
  }

  function startOfWeek(d) {
    // ä»¥é€±ä¸€ç‚ºä¸€é€±é–‹å§‹
    const copy = new Date(d);
    const day = copy.getDay(); // 0(æ—¥)~6(å…­)
    const diff = (day === 0 ? -6 : 1 - day);
    copy.setDate(copy.getDate() + diff);
    copy.setHours(0,0,0,0);
    return copy;
  }

  function addDays(d, n) {
    const copy = new Date(d);
    copy.setDate(copy.getDate() + n);
    return copy;
  }

  function renderGames(containerId, games, titleIfEmpty) {
  const el = document.getElementById(containerId);
  el.innerHTML = "";

  if (!games.length) {
    el.innerHTML = `<p style="color:#666;">${titleIfEmpty}</p>`;
    return;
  }

  // â‘  ä¾æ—¥æœŸåˆ†çµ„
  const grouped = {};
  games.forEach(g => {
    if (!grouped[g.date]) grouped[g.date] = [];
    grouped[g.date].push(g);
  });

  // â‘¡ æŒ‰æ—¥æœŸæ’åºé¡¯ç¤º
  Object.keys(grouped).sort().forEach(date => {
    const dateTitle = document.createElement("h3");
    dateTitle.className = "date-title";
    dateTitle.textContent = `ğŸ“… ${date}`;
    el.appendChild(dateTitle);

    const row = document.createElement("div");
    row.className = "game-row";

    grouped[date].forEach(g => {
      const card = document.createElement("div");
      card.className = "mini-game-card";

      const warn = g.needsConfirm ? " âš ï¸(å¾…ç¢ºèª)" : "";

      card.innerHTML = `
        <div class="mini-teams">${g.away} vs ${g.home}${warn}</div>
        <div class="mini-meta">ğŸ“ çƒå ´ï¼šå¾…è£œ</div>
        <div class="mini-meta">ğŸ•• æ™‚é–“ï¼šå¾…è£œ</div>
      `;
      row.appendChild(card);
    });

    el.appendChild(row);
  });
}

    

  fetch("data/schedule-2026-04.json")
    .then(r => r.json())
    .then(allGames => {
      const today = new Date();
      const todayStr = ymd(today);

      const weekStart = startOfWeek(today);
      const weekEnd = addDays(weekStart, 6);
      const weekStartStr = ymd(weekStart);
      const weekEndStr = ymd(weekEnd);

      const todayGames = allGames.filter(g => g.date === todayStr);

      const weekGames = allGames
        .filter(g => g.date >= weekStartStr && g.date <= weekEndStr)
        .sort((a, b) => a.date.localeCompare(b.date));

      renderGames("today", todayGames, "ä»Šå¤©æ²’æœ‰æ¯”è³½ï¼ˆæˆ–ä¸åœ¨é€™å€‹æœˆä»½è³‡æ–™å…§ï¼‰");
      renderGames("week", weekGames, `æœ¬é€±ï¼ˆ${weekStartStr} ~ ${weekEndStr}ï¼‰æ²’æœ‰æ¯”è³½ï¼ˆæˆ–ä¸åœ¨é€™å€‹æœˆä»½è³‡æ–™å…§ï¼‰`);
    })
    .catch(err => {
      console.error(err);
      document.getElementById("today").innerHTML = `<p style="color:red;">è®€å–å¤±æ•—ï¼š${err.message}</p>`;
      document.getElementById("week").innerHTML = `<p style="color:red;">è®€å–å¤±æ•—ï¼š${err.message}</p>`;
    });
    // ====== é¦–é ï¼šè®€å–æˆ°ç¸¾ Top 3 ======
fetch("data/standings-2026.json")
  .then(r => r.json())
  .then(rows => {
    // è¨ˆç®—å‹ç‡ï¼ˆå’Œå±€ä¸ç®—å‹æ•—ï¼‰
    const normalized = rows.map(r => {
      const wins = Number(r.wins ?? 0);
      const losses = Number(r.losses ?? 0);
      const ties = Number(r.ties ?? 0);
      const winPct = (wins + losses) === 0 ? 0 : wins / (wins + losses);
      return { ...r, wins, losses, ties, winPct };
    });

    normalized.sort((a,b) => b.winPct - a.winPct || b.wins - a.wins);

    const top3 = normalized.slice(0,3);
    const el = document.getElementById("top3");
    if (!el) return;

    el.innerHTML = top3.map((t, i) => {
      const medal = i===0?"ğŸ¥‡":i===1?"ğŸ¥ˆ":"ğŸ¥‰";
      const pct = t.winPct.toFixed(3);
      return `
        <div class="top3-card">
          <div class="top3-rank">${medal} ç¬¬${i+1}</div>
          <div class="top3-team">${t.team}</div>
          <div class="top3-meta">å‹ ${t.wins}ï½œæ•— ${t.losses}ï½œå’Œ ${t.ties}ï½œå‹ç‡ ${pct}</div>
        </div>
      `;
    }).join("");
  })
  .catch(err => {
    const el = document.getElementById("top3");
    if (el) el.innerHTML = `<p style="color:#c00;">æˆ°ç¸¾è®€å–å¤±æ•—ï¼š${err.message}</p>`;
  });
// ====== é¦–é ï¼šå¿«é€Ÿå‰å¾€ã€Œæœ¬æœˆè³½ç¨‹ã€ ======
(function setGoMonth(){
  const a = document.getElementById("goMonth");
  if (!a) return;

  const d = new Date();
  const y = d.getFullYear();
  const m = String(d.getMonth() + 1).padStart(2, "0");
  const month = `${y}-${m}`; // ä¾‹å¦‚ 2026-01

  a.href = `schedule.html?month=${month}`;
  a.textContent = `ğŸ“… å‰å¾€ ${y}/${m} è³½ç¨‹`;
})();

</script>


<footer>
    Â© 2026 CPBL Data Siteï½œæ˜å¡X Chatgptç¶²ç«™
</footer>

</body>
</html>

