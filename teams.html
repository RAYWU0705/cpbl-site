<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <base href="/cpbl-site/">

  <meta charset="UTF-8">
  <title>CPBL 球隊</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>

<nav class="nav">
  <div class="nav-inner">
    <a class="brand" href="index.html">CPBL</a>
    <a class="nav-link" href="index.html">首頁</a>
    <a class="nav-link" href="schedule.html">賽程</a>
    <a class="nav-link" href="standings.html">戰績</a>
    <a class="nav-link active" href="teams.html">球隊</a>
  </div>
</nav>

<header>
  <h1>球隊</h1>
  <p>（搜尋球隊，點一下看詳細資訊）</p>
</header>

<main>
  <div style="margin-bottom:14px; display:flex; gap:12px; flex-wrap:wrap; align-items:center;">
    <label for="teamSearch">搜尋：</label>
    <input id="teamSearch" type="text" placeholder="例如：兄弟 / 獅 / 新莊" style="padding:6px 10px;">
    <button id="reloadBtn">重新讀取</button>
    <span id="statusText" style="color:#666;"></span>
  </div>

  <div class="teams-layout">
    <div id="teamList" class="team-list"></div>
    <div id="teamDetail" class="team-detail">
      <div style="color:#666;">點左邊一支球隊，這裡會顯示詳細資料。</div>
    </div>
  </div>
</main>

<footer>© 2026 CPBL Data Site｜明叡 × ChatGPT</footer>

<script>
const teamList   = document.getElementById("teamList");
const teamDetail = document.getElementById("teamDetail");
const teamSearch = document.getElementById("teamSearch");
const reloadBtn  = document.getElementById("reloadBtn");
const statusText = document.getElementById("statusText");

let teams = [];

function setStatus(msg){ statusText.textContent = msg; }

function colorDot(hex){
  return `<span class="color-dot" style="background:${hex};"></span>`;
}

function renderList(rows){
  teamList.innerHTML = "";

  if (!rows || rows.length === 0){
    teamList.innerHTML = "<p style='color:#666;'>沒有符合的球隊</p>";
    return;
  }

  rows.forEach(t => {
    const card = document.createElement("button");
    card.type = "button";
    card.className = "team-card";
    card.innerHTML = `
      <div class="team-card-title">${t.name}</div>
      <div class="team-card-sub">主場：${t.home}</div>
      <div class="team-card-colors">
        ${(t.colors || []).slice(0,2).map(colorDot).join("")}
      </div>
    `;
    card.addEventListener("click", () => {
  location.href = `team.html?id=${encodeURIComponent(t.id)}`;
});

    teamList.appendChild(card);
  });
}

function renderDetail(t){
  teamDetail.innerHTML = `
    <div class="detail-card">
      <div class="detail-title">${t.name}（${t.short || ""}）</div>
      <div class="detail-row"><b>城市：</b> ${t.city || "-"}</div>
      <div class="detail-row"><b>主場：</b> ${t.home || "-"}</div>
      <div class="detail-row"><b>成立：</b> ${t.founded || "-"}</div>
      <div class="detail-row"><b>主色：</b>
        ${(t.colors || []).slice(0,3).map(colorDot).join("")}
      </div>
      <div class="detail-intro">${t.intro || ""}</div>
    </div>
  `;
}

function applySearch(){
  const q = teamSearch.value.trim();
  if (!q){
    renderList(teams);
    return;
  }
  const filtered = teams.filter(t =>
    (t.name || "").includes(q) ||
    (t.city || "").includes(q) ||
    (t.home || "").includes(q) ||
    (t.short || "").includes(q)
  );
  renderList(filtered);
}

async function loadTeams(){
  setStatus("載入中：data/teams.json");
  teamList.innerHTML = "";
  teamDetail.innerHTML = `<div style="color:#666;">載入中…</div>`;

  try{
    const res = await fetch("data/teams.json");
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    const data = await res.json();
    if (!Array.isArray(data)) throw new Error("teams.json 不是陣列");

    teams = data;
    setStatus(`✅ 已載入：${teams.length} 隊`);
    renderList(teams);

    // 預設顯示第一隊詳細
    if (teams.length > 0) renderDetail(teams[0]);

    console.log("✅ teams 載入成功", teams);
  }catch(err){
    console.error("❌ teams 載入失敗", err);
    setStatus("❌ 載入失敗：請確認 Live Server 與 data/teams.json");
    teamList.innerHTML = "<p style='color:red;'>球隊資料讀取失敗</p>";
    teamDetail.innerHTML = "";
  }
}

reloadBtn.addEventListener("click", loadTeams);
teamSearch.addEventListener("input", applySearch);

// 預設載入
loadTeams();
</script>

</body>
</html>

