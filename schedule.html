<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <base href="/cpbl-site/">

  <meta charset="UTF-8">
  <title>CPBL è³½ç¨‹</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>

<nav class="nav">
  <div class="nav-inner">
    <a class="brand" href="index.html">CPBL</a>
    <a class="nav-link" href="index.html">é¦–é </a>
    <a class="nav-link active" href="schedule.html">è³½ç¨‹</a>
    <a class="nav-link" href="standings.html">æˆ°ç¸¾</a>
    <a class="nav-link" href="teams.html">çƒéšŠ</a>
  </div>
</nav>

<header>
  <h1>å®Œæ•´è³½ç¨‹</h1>
  <p>ï¼ˆå¯ä¾æœˆä»½ã€è³½äº‹é¡å‹ã€çƒéšŠèˆ‡æ—¥æœŸç¯©é¸ï¼‰</p>
</header>

<main>
  <!-- ç¯©é¸å€ -->
  <div style="margin-bottom:20px; display:flex; gap:12px; flex-wrap:wrap; align-items:center;">

    <label>æœˆä»½ï¼š</label>
    <select id="monthSelect">
      <option value="2026-03">2026-03ï¼ˆå«ç†±èº«/é–‹å¹•ï¼‰</option>
      <option value="2026-04">2026-04</option>
      <option value="2026-05">2026-05</option>
      <option value="2026-06">2026-06</option>
      <option value="2026-07">2026-07</option>
    </select>

    <label>è³½äº‹ï¼š</label>
    <select id="typeSelect">
      <option value="ALL">å…¨éƒ¨</option>
      <option value="preseason">ç†±èº«è³½</option>
      <option value="regular">ä¾‹è¡Œè³½</option>
      <option value="allstar">æ˜æ˜Ÿè³½</option>
      <option value="playoff">å­£å¾Œè³½</option>
      <option value="finals">ç¸½å† è»è³½</option>
    </select>

    <label>çƒéšŠï¼š</label>
    <select id="teamSelect">
      <option value="ALL">å…¨éƒ¨çƒéšŠ</option>
      <option value="ä¸­ä¿¡å…„å¼Ÿ">ä¸­ä¿¡å…„å¼Ÿ</option>
      <option value="çµ±ä¸€7-ELEVEnç…">çµ±ä¸€7-ELEVEnç…</option>
      <option value="æ¨‚å¤©æ¡ƒçŒ¿">æ¨‚å¤©æ¡ƒçŒ¿</option>
      <option value="å‘³å…¨é¾">å‘³å…¨é¾</option>
      <option value="å¯Œé‚¦æ‚å°‡">å¯Œé‚¦æ‚å°‡</option>
      <option value="å°é‹¼é›„é·¹">å°é‹¼é›„é·¹</option>
    </select>

    <label>æ—¥æœŸï¼š</label>
    <input type="date" id="dateSelect">
    <button id="clearDate">æ¸…é™¤æ—¥æœŸ</button>

    <label>
      <input type="checkbox" id="completeOnly">
      åªçœ‹è³‡æ–™å®Œæ•´
    </label>

    <span id="statusText" style="color:#666;"></span>
    <span id="missingSummary" style="color:#666;"></span>
  </div>

  <!-- è³½ç¨‹åˆ—è¡¨ -->
  <div id="scheduleList"></div>
</main>

<footer>Â© 2026 CPBL Data Siteï½œæ˜å¡ Ã— ChatGPT</footer>

<script>
/* ========= DOM ========= */
const monthSelect = document.getElementById("monthSelect");
const typeSelect  = document.getElementById("typeSelect");
const teamSelect  = document.getElementById("teamSelect");
const dateInput   = document.getElementById("dateSelect");
const clearBtn    = document.getElementById("clearDate");
const list        = document.getElementById("scheduleList");
const statusText  = document.getElementById("statusText");
const completeOnly = document.getElementById("completeOnly");
const missingSummary = document.getElementById("missingSummary");

/* ========= è³‡æ–™ ========= */
let allGames = [];

/* ========= å·¥å…· ========= */
function setStatus(msg){ statusText.textContent = msg; }

function typeLabel(t){
  if (t === "preseason") return "ï¼ˆç†±èº«è³½ï¼‰";
  if (t === "regular")   return "ï¼ˆä¾‹è¡Œè³½ï¼‰";
  if (t === "allstar")   return "ï¼ˆæ˜æ˜Ÿè³½ï¼‰";
  if (t === "playoff")   return "ï¼ˆå­£å¾Œè³½ï¼‰";
  if (t === "finals")    return "ï¼ˆç¸½å† è»è³½ï¼‰";
  return "";
}

/* ========= è¼‰å…¥ JSON ========= */
function loadMonth(month){
  const url = `data/schedule-${month}.json`;
  setStatus(`è¼‰å…¥ä¸­ï¼š${url}`);
  list.innerHTML = "";

  fetch(url)
    .then(res => {
      if (!res.ok) throw new Error(res.status);
      return res.json();
    })
    .then(data => {
      allGames = Array.isArray(data) ? data : [];
      setStatus(`âœ… å·²è¼‰å…¥ ${month}ï¼ˆ${allGames.length} å ´ï¼‰`);
      applyFilter();
    })
    .catch(() => {
      setStatus(`âŒ è¼‰å…¥å¤±æ•—ï¼š${url}`);
      list.innerHTML = "<p style='color:red;'>æ­¤æœˆä»½å°šæœªå»ºç«‹è³½ç¨‹ JSON</p>";
    });
}

/* ========= æ¸²æŸ“ ========= */
function render(games){
  list.innerHTML = "";

  if (!games.length){
    list.innerHTML = "<p style='color:#666;'>ç›®å‰æ²’æœ‰ç¬¦åˆæ¢ä»¶çš„è³½ç¨‹</p>";
    return;
  }

  const grouped = {};
  games.forEach(g => {
    if (!grouped[g.date]) grouped[g.date] = [];
    grouped[g.date].push(g);
  });

  Object.keys(grouped).sort().forEach(date => {
    const h3 = document.createElement("h3");
    h3.textContent = `ğŸ“… ${date}`;
    list.appendChild(h3);

    const row = document.createElement("div");
    row.className = "game-row";

    grouped[date].forEach(g => {
      const card = document.createElement("div");
      card.className = "game-card home-game";

      let badges = "";
      if (g.isOpeningDay) badges += `<span class="badge opening">ğŸ”¥ é–‹å¹•æˆ°</span>`;
      if (g.type === "allstar") badges += `<span class="badge allstar">â­ æ˜æ˜Ÿè³½</span>`;
      if (g.type === "playoff") badges += `<span class="badge postseason">ğŸ† å­£å¾Œè³½</span>`;
      if (g.type === "finals") badges += `<span class="badge finals">ğŸ‘‘ ç¸½å† è»è³½</span>`;

      const city = g.venue?.city || "å¾…è£œ";
      const stadium = g.venue?.stadium || "å¾…è£œ";

      card.innerHTML = `
        <div class="teams">
          ${g.away} vs ${g.home}
          ${badges}
          ${typeLabel(g.type)}
        </div>
        <div class="info">ğŸ“ ${city}ï½œ${stadium}</div>
      `;

      row.appendChild(card);
    });

    list.appendChild(row);
  });
}

/* ========= ç¯©é¸ ========= */
function applyFilter(){
  let filtered = [...allGames];

  if (typeSelect.value !== "ALL"){
    filtered = filtered.filter(g => (g.type || "regular") === typeSelect.value);
  }

  if (teamSelect.value !== "ALL"){
    filtered = filtered.filter(g => g.home === teamSelect.value || g.away === teamSelect.value);
  }

  if (dateInput.value){
    filtered = filtered.filter(g => g.date === dateInput.value);
  }

  if (completeOnly.checked){
    filtered = filtered.filter(isCompleteGame);
  }

  renderMissingSummary(allGames);
  render(filtered);
}

/* ========= ç¼ºæ¼ ========= */
function isCompleteGame(g){
  return g.venue?.city && g.venue?.stadium && g.time;
}

function renderMissingSummary(games){
  let mc=0, ms=0, mt=0;
  games.forEach(g=>{
    if(!g.venue?.city) mc++;
    if(!g.venue?.stadium) ms++;
    if(!g.time) mt++;
  });
  missingSummary.textContent =
    games.length ? `ï½œå¾…è£œï¼šåŸå¸‚ ${mc}ã€çƒå ´ ${ms}ã€æ™‚é–“ ${mt}` : "";
}

/* ========= äº‹ä»¶ ========= */
monthSelect.addEventListener("change", ()=>loadMonth(monthSelect.value));
typeSelect.addEventListener("change", applyFilter);
teamSelect.addEventListener("change", applyFilter);
dateInput.addEventListener("change", applyFilter);
clearBtn.addEventListener("click", ()=>{ dateInput.value=""; applyFilter(); });
completeOnly.addEventListener("change", applyFilter);

/* ========= é è¨­ ========= */
loadMonth(monthSelect.value);
</script>

</body>
</html>

