<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <base href="/cpbl-site/">

  <meta charset="UTF-8">
  <title>CPBL æˆ°ç¸¾</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>

<nav class="nav">
  <div class="nav-inner">
    <a class="brand" href="index.html">CPBL</a>
    <a class="nav-link" href="index.html">é¦–é </a>
    <a class="nav-link" href="schedule.html">è³½ç¨‹</a>
    <a class="nav-link active" href="standings.html">æˆ°ç¸¾</a>
    <a class="nav-link" href="teams.html">çƒéšŠ</a>
  </div>
</nav>

<header>
  <h1>æˆ°ç¸¾</h1>
  <p>ï¼ˆç›®å‰ç‚ºæ‰‹å‹•æˆ°ç¸¾è¡¨ï¼›æœªä¾†å¯å‡ç´šè‡ªå‹•è¨ˆç®—ï¼‰</p>
</header>

<main>
  <div style="margin-bottom:16px; display:flex; gap:12px; flex-wrap:wrap; align-items:center;">
    <label for="seasonSelect">è³½å­£ï¼š</label>
    <select id="seasonSelect">
      <option value="2026">2026</option>
    </select>
    <label for="splitSelect">å€æ®µï¼š</label>
<select id="splitSelect">
  <option value="full">å…¨å¹´</option>
  <option value="first">ä¸ŠåŠå­£</option>
  <option value="second">ä¸‹åŠå­£</option>
</select>

<label for="teamSearch">æœå°‹çƒéšŠï¼š</label>
<input id="teamSearch" type="text" placeholder="ä¾‹å¦‚ï¼šä¸­ä¿¡ / å…„å¼Ÿ / çŒ¿" style="padding:6px 10px;">

    <button id="reloadBtn">é‡æ–°è®€å–</button>

    <span id="statusText" style="color:#666;"></span>
  </div>

  <div id="standingsWrap"></div>

  <hr style="margin:24px 0; opacity:.25;">

  <details>
    <summary style="cursor:pointer;">ğŸ“Œ æœªä¾†å‡ç´šï¼šè‡ªå‹•è¨ˆç®—æˆ°ç¸¾ï¼ˆéœ€è¦æ¯”åˆ†ï¼‰</summary>
    <div style="margin-top:10px; color:#444; line-height:1.7;">
      <p>å¦‚æœä½ ä¹‹å¾Œåœ¨è³½ç¨‹ JSON åŠ ä¸Šæ¯”åˆ†æ¬„ä½ï¼Œä¾‹å¦‚ï¼š</p>
      <pre style="background:#fff; padding:12px; border-radius:8px; overflow:auto; border:1px solid rgba(0,0,0,0.1);">
{"date":"2026-04-01","away":"å‘³å…¨é¾","home":"ä¸­ä¿¡å…„å¼Ÿ","awayScore":3,"homeScore":5}
      </pre>
      <p>é‚£æˆ‘å¯ä»¥å¹«ä½ åœ¨é€™é åŠ ã€Œä¸€éµå¾è³½ç¨‹è‡ªå‹•è¨ˆç®—ã€æŒ‰éˆ•ã€‚</p>
    </div>
  </details>
</main>

<footer>Â© 2026 CPBL Data Siteï½œæ˜å¡ Ã— ChatGPT</footer>

<script>
  /* ========= DOM ========= */
const standingsWrap = document.getElementById("standingsWrap");
const seasonSelect  = document.getElementById("seasonSelect");
const splitSelect   = document.getElementById("splitSelect");
const reloadBtn     = document.getElementById("reloadBtn");
const statusText    = document.getElementById("statusText");
const teamSearch    = document.getElementById("teamSearch");

/* ========= å¸¸æ•¸ ========= */
const TEAMS = [
  "ä¸­ä¿¡å…„å¼Ÿ",
  "çµ±ä¸€7-ELEVEnç…",
  "æ¨‚å¤©æ¡ƒçŒ¿",
  "å‘³å…¨é¾",
  "å¯Œé‚¦æ‚å°‡",
  "å°é‹¼é›„é·¹"
];

/* ========= ç‹€æ…‹ ========= */
let rawRows = [];

/* ========= å·¥å…· ========= */
function setStatus(msg) {
  statusText.textContent = msg;
}

/* ========= æ ¸å¿ƒï¼šè¨ˆç®—æˆ°ç¸¾ ========= */
function calculateStandings(games) {
  const table = {};
  TEAMS.forEach(t => {
    table[t] = { team: t, games: 0, wins: 0, losses: 0, ties: 0 };
  });

  games.forEach(g => {
    if (typeof g.homeScore !== "number" || typeof g.awayScore !== "number") return;

    const home = table[g.home];
    const away = table[g.away];
    if (!home || !away) return;

    home.games++;
    away.games++;

    if (g.homeScore > g.awayScore) {
      home.wins++; away.losses++;
    } else if (g.homeScore < g.awayScore) {
      away.wins++; home.losses++;
    } else {
      home.ties++; away.ties++;
    }
  });

  return Object.values(table).map(r => {
    const denom = r.wins + r.losses;
    const winPct = denom === 0 ? 0 : r.wins / denom;
    return { ...r, winPct: winPct.toFixed(3) };
  });
}

/* ========= é¡¯ç¤º ========= */
function renderStandings(rows) {
  if (!rows.length) {
    standingsWrap.innerHTML = "<p>å°šç„¡æˆ°ç¸¾è³‡æ–™</p>";
    return;
  }

  rows.sort((a,b) => b.winPct - a.winPct || b.wins - a.wins);
  rawRows = rows;

  standingsWrap.innerHTML = `
    <table class="standings-table">
      <thead>
        <tr>
          <th>#</th><th>çƒéšŠ</th><th>å ´</th><th>å‹</th><th>æ•—</th><th>å’Œ</th><th>å‹ç‡</th>
        </tr>
      </thead>
      <tbody>
        ${rows.map((r,i)=>`
          <tr>
            <td>${i+1}</td>
            <td>${r.team}</td>
            <td>${r.games}</td>
            <td>${r.wins}</td>
            <td>${r.losses}</td>
            <td>${r.ties}</td>
            <td>${r.winPct}</td>
          </tr>
        `).join("")}
      </tbody>
    </table>
  `;
}

/* ========= å¾è³½ç¨‹è®€å– ========= */
async function loadStandingsFromSchedule() {
  setStatus("è¨ˆç®—ä¸­â€¦");

  const months = ["2026-03","2026-04","2026-05","2026-06","2026-07"];
  let allGames = [];

  for (const m of months) {
    try {
      const res = await fetch(`data/schedule-${m}.json`);
      if (!res.ok) continue;
      const data = await res.json();
      allGames = allGames.concat(data);
    } catch {}
  }

  const rows = calculateStandings(allGames);
  setStatus(`âœ… å·²è¨ˆç®—ï¼ˆ${rows.length} éšŠï¼‰`);
  renderStandings(rows);
}

/* ========= äº‹ä»¶ ========= */
reloadBtn.addEventListener("click", loadStandingsFromSchedule);
seasonSelect.addEventListener("change", loadStandingsFromSchedule);
splitSelect.addEventListener("change", loadStandingsFromSchedule);

teamSearch.addEventListener("input", () => {
  const q = teamSearch.value.trim();
  if (!q) return renderStandings(rawRows);
  renderStandings(rawRows.filter(r => r.team.includes(q)));
});

/* ========= å•Ÿå‹• ========= */
loadStandingsFromSchedule();

</script>

</body>
</html>


